name: Test Mutiwfn MacOS-14-arm64

on:
  push:
    branches:
      - master

jobs:
  MacOS-Arm64:
    runs-on: macos-14
    steps:
    - name: Checkout
      uses: actions/checkout@v3

    - name: Check system
      run: |
        echo "macOS version: $(sw_vers -productVersion)"
        echo "macOS kernel: $(uname -r)"
        echo "macOS arch: $(uname -m)"

    - name: FFMPEG
      run: | 
        brew install ffmpeg
        unzip Multiwfn3.8_latest_MacOS.zip
        chmod a+x Multiwfn
        install_name_tool -change /Users/runner/work/Multiwfn_compile/Multiwfn_compile/dislin/libdislin_d.dylib@loader_path/libdislin_d.dylib Multiwfn

    - name: Start recording
      run: |
        ./Multiwfn misc/examples/phenylalanineresiduestrimer.xyz <<< "0" &
        sleep 2
        ffmpeg -video_size 1280x1024 -framerate 25 -f x11grab -i :99.0 -t 10 out.mp4

    - name: Upload recording
      uses: actions/upload-artifact@v4
      with:
        name: gui-recording
        path: out.mp4

    # - name: Test
    #   uses: GabrielBB/xvfb-action@v1
    #   with:
    #     run: |
    #       unzip Multiwfn3.8_latest_MacOS.zip
    #       chmod a+x Multiwfn
    #       install_name_tool -change /Users/runner/work/Multiwfn_compile/Multiwfn_compile/dislin/libdislin_d.dylib @loader_path/libdislin_d.dylib Multiwfn
    #       ./Multiwfn misc/examples/phenylalanineresiduestrimer.xyz <<< "0"
    #     working-directory:  ${{ github.workspace }}
    #     options: #optional
